<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bambu Lab Printer Monitor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.js"></script>
    <style>
        body { 
            background-color: #f8f9fa; 
            min-height: 100vh;
        }
        
        .printer-card {
            transition: all 0.3s ease;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .printer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
        }
        
        .progress {
            height: 25px;
            background-color: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .status-badge {
            font-size: 0.9em;
            padding: 0.5em 0.8em;
        }
        
        .error-alert {
            border-left: 4px solid #dc3545;
            animation: errorPulse 2s infinite;
        }
        
        @keyframes errorPulse {
            0% { border-left-color: #dc3545; }
            50% { border-left-color: #ff8b99; }
            100% { border-left-color: #dc3545; }
        }
        
        .card-header-custom {
            background: rgb(33, 37, 41);
            color: white;
            border-radius: 8px 8px 0 0 !important;
            position: relative;
            padding: 1rem;
        }
        
        .status-item {
            padding: 12px;
            border-radius: 8px;
            background-color: rgba(0,0,0,0.03);
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .status-item:hover {
            background-color: rgba(0,0,0,0.06);
        }
        
        .status-icon {
            width: 24px;
            text-align: center;
            margin-right: 10px;
            color: #6c757d;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .connection-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        
        .connection-status.connected { 
            background-color: #28a745;
            box-shadow: 0 0 8px rgba(40, 167, 69, 0.5);
        }
        
        .connection-status.disconnected { 
            background-color: #dc3545;
            box-shadow: 0 0 8px rgba(220, 53, 69, 0.5);
        }
        
        .connection-status.connecting { 
            background-color: #ffc107;
            animation: connecting 1s infinite;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.5);
        }
        
        @keyframes connecting {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }

        .modal-dark .modal-content {
            background-color: #343a40;
            color: white;
        }
        
        .modal-dark .form-control,
        .modal-dark .form-select {
            background-color: #495057;
            border-color: #6c757d;
            color: white;
        }
        
        .modal-dark .form-control:focus,
        .modal-dark .form-select:focus {
            background-color: #495057;
            color: white;
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13,110,253,.25);
        }
        
        .confirm-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1050;
            align-items: center;
            justify-content: center;
        }
        
        .confirm-dialog-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
        }

        .printer-type-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            background: rgba(255,255,255,0.2);
        }

        .btn-group-action {
            gap: 0.5rem;
        }

        .btn-action {
            flex: 1;
            transition: all 0.2s ease;
        }

        .btn-action:hover {
            transform: translateY(-2px);
        }

        .progress-info {
            position: relative;
            margin: 1rem 0;
        }

        .progress-percentage {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 25px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            z-index: 1;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-print me-2"></i>
                Bambu Lab Printer Monitor
            </a>
            <div>
                <span id="globalConnectionStatus" class="badge bg-warning me-3 d-none">
                    <i class="fas fa-plug me-1"></i>
                    Connecting...
                </span>
                <button class="btn btn-success" onclick="showConfigModal()">
                    <i class="fas fa-plus me-2"></i>Add Printer
                </button>
            </div>
        </div>
    </nav>

    <div class="container mb-5">
        <div id="connectionBanner" class="alert alert-warning mb-4 d-none">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span id="connectionMessage">Connecting to server...</span>
        </div>

        <div id="printerGrid" class="row g-4">
            <div id="loadingPlaceholder" class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Loading printers...</p>
            </div>
        </div>
    </div>

    <!-- Configuration Modal -->
    <div class="modal fade modal-dark" id="configModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add Printer</h5>
                    <button type="button" class="btn-close btn-close-white" onclick="hideConfigModal()"></button>
                </div>
                <div class="modal-body">
                    <form id="printerForm" onsubmit="savePrinterSettings(event)">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Host</label>
                                <input type="text" class="form-control" id="host" name="host" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Port</label>
                                <input type="number" class="form-control" id="port" name="port" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">User</label>
                                <input type="text" class="form-control" id="user" name="user" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Device ID</label>
                                <input type="text" class="form-control" id="device_id" name="device_id" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Printer Title</label>
                                <input type="text" class="form-control" id="printer_title" name="Printer_Title" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Printer Type</label>
                                <select class="form-select" id="printer_type" name="printer_type" required>
                                    <option value="X1C">X1 Carbon</option>
                                    <option value="P1S">P1S</option>
                                    <option value="A1">A1</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Pushover Sound</label>
                                <input type="text" class="form-control" id="po_sound" name="PO_SOUND" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Pushover User Key</label>
                                <input type="text" class="form-control" id="pushover_user" name="my_pushover_user" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Pushover App Key</label>
                                <input type="text" class="form-control" id="pushover_app" name="my_pushover_app" required>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch mt-4">
                                    <input class="form-check-input" type="checkbox" id="ledlight" name="ledlight">
                                    <label class="form-check-label">LED Light Control</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">WLED IP</label>
                                <input type="text" class="form-control" id="wled_ip" name="wled_ip">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Printer Color</label>
                                <input type="color" class="form-control form-control-color w-100" id="color" name="color" value="#000000">
                            </div>
                        </div>
                        <input type="hidden" id="editMode" value="add">
                        <div class="mt-4 text-end">
                            <button type="button" class="btn btn-secondary me-2" onclick="hideConfigModal()">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Printer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirmDialog" class="confirm-dialog">
        <div class="confirm-dialog-content">
            <h5 class="mb-3">Confirm Action</h5>
            <p id="confirmMessage"></p>
            <div class="d-flex justify-content-end gap-2">
                <button class="btn btn-secondary" onclick="hideConfirmDialog()">Cancel</button>
                <button id="confirmButton" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toastContainer"></div>
    </div>
<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script>
    // Global variables
    const socket = io();
    let printers = [];
    let configModal;
    let reconnectAttempts = {};
    let connectionStatus = 'connecting';

    // Socket connection handling
    socket.on('connect', () => {
        showConnectionStatus('connected');
        showToast('Connected to server', 'success');
        document.getElementById('globalConnectionStatus').classList.add('d-none');
    });

    socket.on('disconnect', () => {
        showConnectionStatus('disconnected');
        showToast('Disconnected from server', 'error');
        document.getElementById('globalConnectionStatus').classList.remove('d-none');
        document.getElementById('globalConnectionStatus').classList.remove('bg-success');
        document.getElementById('globalConnectionStatus').classList.add('bg-danger');
        document.getElementById('globalConnectionStatus').innerHTML = '<i class="fas fa-plug me-1"></i>Disconnected';
    });

    socket.on('printer_update', (data) => {
        const printerIndex = printers.findIndex(p => p.device_id === data.printer_id);
        if (printerIndex !== -1) {
            const previousStatus = printers[printerIndex].status?.state;
            printers[printerIndex].status = data;
            printers[printerIndex].connected = true;
            updatePrinterCard(printers[printerIndex]);

            // Notify on state changes
            if (previousStatus && previousStatus !== data.state) {
                showToast(`${printers[printerIndex].printer_title}: Status changed to ${data.state}`, 
                         getStateNotificationType(data.state));
            }

            // Notify on errors
            if (data.error_messages?.length) {
                data.error_messages.forEach(error => {
                    showToast(`${printers[printerIndex].printer_title}: ${error}`, 'error');
                });
            }
        }
    });

    // Utility Functions
    function getStateNotificationType(state) {
        switch(state?.toLowerCase()) {
            case 'printing': return 'info';
            case 'finish': return 'success';
            case 'failed': return 'error';
            default: return 'warning';
        }
    }

    function getStatusClass(state) {
        switch(state?.toLowerCase()) {
            case 'printing': return 'bg-primary';
            case 'finish': return 'bg-success';
            case 'failed': return 'bg-danger';
            case 'idle': return 'bg-secondary';
            default: return 'bg-warning';
        }
    }

    function showConnectionStatus(status) {
        connectionStatus = status;
        const banner = document.getElementById('connectionBanner');
        const message = document.getElementById('connectionMessage');
        
        switch(status) {
            case 'connected':
                banner.classList.add('d-none');
                break;
            case 'disconnected':
                banner.classList.remove('d-none');
                banner.classList.remove('alert-warning');
                banner.classList.add('alert-danger');
                message.textContent = 'Disconnected from server. Attempting to reconnect...';
                break;
            case 'connecting':
                banner.classList.remove('d-none');
                banner.classList.remove('alert-danger');
                banner.classList.add('alert-warning');
                message.textContent = 'Connecting to server...';
                break;
        }
    }

    function showToast(message, type = 'info') {
        const bgColor = {
            success: '#28a745',
            error: '#dc3545',
            warning: '#ffc107',
            info: '#17a2b8'
        }[type];

        const textColor = type === 'warning' ? '#000' : '#fff';

        Toastify({
            text: message,
            duration: 3000,
            gravity: "bottom",
            position: "right",
            style: { 
                background: bgColor,
                color: textColor
            }
        }).showToast();
    }

    // Printer Card Management
    function createPrinterCard(printer) {
        const statusClass = getStatusClass(printer.status?.state);
        const cardHtml = `
            <div class="col-md-6 col-lg-4">
                <div class="card printer-card shadow-sm" id="printer-${printer.device_id}">
                    <div class="card-header card-header-custom" style="background: ${printer.color}">
                        <span class="printer-type-badge">${printer.printer_type}</span>
                        <div class="connection-status ${printer.connected ? 'connected' : 'disconnected'}"></div>
                        <h5 class="card-title mb-0">
                            <i class="fas fa-print me-2"></i>
                            ${printer.printer_title}
                        </h5>
                    </div>
                    <div class="card-body">
                        ${printer.status?.error_messages?.length ? `
                            <div class="alert alert-danger error-alert mb-3">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                ${printer.status.error_messages.join('<br>')}
                            </div>
                        ` : ''}
                        
                        <div class="progress-info">
                            <div class="progress">
                                <div class="progress-bar ${statusClass}" role="progressbar" 
                                     style="width: ${printer.status?.percent || 0}%; background: ${printer.color}"
                                     aria-valuenow="${printer.status?.percent || 0}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                </div>
                            </div>
                            <div class="progress-percentage">${printer.status?.percent || 0}%</div>
                        </div>

                        <div class="status-item">
                            <i class="fas fa-info-circle status-icon"></i>
                            <span>State: <span class="badge ${statusClass} ms-1">
                                ${printer.status?.state || 'Unknown'}
                            </span></span>
                        </div>
                        
                        <div class="status-item">
                            <i class="fas fa-tasks status-icon"></i>
                            <span>Stage: ${printer.status?.current_stage || 'Unknown'}</span>
                        </div>
                        
                        <div class="status-item">
                            <i class="fas fa-file-alt status-icon"></i>
                            <span>Project: ${printer.status?.project_name || 'None'}</span>
                        </div>
                        
                        <div class="status-item">
                            <i class="fas fa-layer-group status-icon"></i>
                            <span>Layers: ${printer.status?.lines || 0}/${printer.status?.lines_total || 0}</span>
                        </div>
                        
                        <div class="status-item">
                            <i class="fas fa-clock status-icon"></i>
                            <span>Time Left: ${printer.status?.remaining_time || 'Unknown'}</span>
                        </div>
                        
                        <div class="status-item">
                            <i class="fas fa-calendar-alt status-icon"></i>
                            <span>Expected Finish: ${printer.status?.approx_end || 'Unknown'}</span>
                        </div>

                        <div class="d-flex btn-group-action mt-4">
                            <button class="btn btn-outline-danger btn-action" onclick="confirmDelete('${printer.device_id}')">
                                <i class="fas fa-trash-alt me-2"></i>Delete
                            </button>
                            <button class="btn btn-outline-primary btn-action" onclick="editPrinter('${printer.device_id}')">
                                <i class="fas fa-edit me-2"></i>Edit
                            </button>
                            <button class="btn btn-outline-success btn-action" onclick="reconnectPrinter('${printer.device_id}')">
                                <i class="fas fa-sync-alt me-2"></i>Reconnect
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        return cardHtml;
    }

    function updatePrinterGrid() {
        const grid = document.getElementById('printerGrid');
        grid.innerHTML = printers.map(printer => createPrinterCard(printer)).join('');
    }

    function updatePrinterCard(printer) {
        const cardElement = document.getElementById(`printer-${printer.device_id}`);
        if (cardElement) {
            cardElement.parentElement.outerHTML = createPrinterCard(printer);
        }
    }

    // Modal Management
    function showConfigModal(editMode = 'add') {
        document.getElementById('modalTitle').textContent = editMode === 'add' ? 'Add Printer' : 'Edit Printer';
        document.getElementById('editMode').value = editMode;
        configModal.show();
    }

    function hideConfigModal() {
        configModal.hide();
        document.getElementById('printerForm').reset();
    }

    // Confirmation Dialog
    function showConfirmDialog(message, confirmCallback) {
        const dialog = document.getElementById('confirmDialog');
        document.getElementById('confirmMessage').textContent = message;
        document.getElementById('confirmButton').onclick = () => {
            confirmCallback();
            hideConfirmDialog();
        };
        dialog.style.display = 'flex';
    }

    function hideConfirmDialog() {
        document.getElementById('confirmDialog').style.display = 'none';
    }

    // Printer Management Functions
    function confirmDelete(printerId) {
        const printer = printers.find(p => p.device_id === printerId);
        if (printer) {
            showConfirmDialog(
                `Are you sure you want to delete printer "${printer.printer_title}"?`,
                () => deletePrinter(printerId)
            );
        }
    }

    async function deletePrinter(printerId) {
        try {
            const response = await fetch('/delete_printer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ printer_id: printerId })
            });

            if (response.ok) {
                const printer = printers.find(p => p.device_id === printerId);
                printers = printers.filter(p => p.device_id !== printerId);
                updatePrinterGrid();
                showToast(`Printer "${printer.printer_title}" deleted successfully`, 'success');
            } else {
                showToast('Failed to delete printer', 'error');
            }
        } catch (error) {
            console.error('Error deleting printer:', error);
            showToast('Error deleting printer', 'error');
        }
    }

    function editPrinter(printerId) {
        const printer = printers.find(p => p.device_id === printerId);
        if (printer) {
            Object.keys(printer).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = printer[key];
                    } else {
                        element.value = printer[key];
                    }
                }
            });
            showConfigModal('edit');
        }
    }

    async function reconnectPrinter(printerId) {
        try {
            const printer = printers.find(p => p.device_id === printerId);
            showToast(`Attempting to reconnect ${printer.printer_title}...`, 'info');
            
            const response = await fetch('/reconnect_printer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ printer_id: printerId })
            });

            if (response.ok) {
                showToast(`Reconnection initiated for ${printer.printer_title}`, 'success');
            } else {
                showToast(`Failed to reconnect ${printer.printer_title}`, 'error');
            }
        } catch (error) {
            console.error('Error reconnecting printer:', error);
            showToast('Error reconnecting printer', 'error');
        }
    }

    async function savePrinterSettings(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());
        data.ledlight = formData.get('ledlight') === 'on';

        try {
            const response = await fetch('/save_printer_settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const result = await response.json();
                if (result.status === 'success') {
                    const printerIndex = printers.findIndex(p => p.device_id === data.device_id);
                    if (printerIndex !== -1) {
                        printers[printerIndex] = { ...printers[printerIndex], ...data };
                        showToast(`Printer "${data.Printer_Title}" updated successfully`, 'success');
                    } else {
                        printers.push(data);
                        showToast(`Printer "${data.Printer_Title}" added successfully`, 'success');
                    }
                    updatePrinterGrid();
                    hideConfigModal();
                }
            } else {
                showToast('Failed to save printer settings', 'error');
            }
        } catch (error) {
            console.error('Error saving printer:', error);
            showToast('Error saving printer settings', 'error');
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
        configModal = new bootstrap.Modal(document.getElementById('configModal'));
        showConnectionStatus('connecting');

        try {
            const response = await fetch('/');
            const data = await response.json();
            printers = data.printers.map(printer => ({
                ...printer,
                connected: false
            }));
            updatePrinterGrid();
            document.getElementById('loadingPlaceholder').classList.add('d-none');
        } catch (error) {
            console.error('Error loading printers:', error);
            showToast('Error loading printers', 'error');
        }
    });
    class PrinterMonitor {
        constructor() {
            this.socket = io();
            this.connectionStatus = document.getElementById('globalConnectionStatus');
            this.printerGrid = document.getElementById('printerGrid');
            this.setupSocketHandlers();
            this.reconnectAttempts = 0;
            this.maxReconnectAttempts = 5;
        }
    
        setupSocketHandlers() {
            // Connection handling
            this.socket.on('connect', () => {
                this.connectionStatus.classList.add('d-none');
                this.reconnectAttempts = 0;
                this.refreshPrinters();
            });
    
            this.socket.on('disconnect', () => {
                this.connectionStatus.classList.remove('d-none');
                this.handleDisconnect();
            });
    
            // Printer updates
            this.socket.on('printer_update', (data) => {
                this.updatePrinterCard(data);
            });
    
            // Authentication status
            this.socket.on('auth_status', (data) => {
                this.handleAuthStatus(data);
            });
        }
    
        async handleDisconnect() {
            if (this.reconnectAttempts < this.maxReconnectAttempts) {
                this.reconnectAttempts++;
                await new Promise(resolve => setTimeout(resolve, 5000));
                this.socket.connect();
            } else {
                this.showError('Connection lost. Please refresh the page.');
            }
        }
    
        updatePrinterCard(data) {
            const printerId = data.printer_id;
            let printerCard = document.getElementById(`printer-${printerId}`);
            
            if (!printerCard) {
                printerCard = this.createPrinterCard(data);
                this.printerGrid.appendChild(printerCard);
            }
    
            // Update status with error handling
            try {
                this.updatePrinterStatus(printerCard, data);
            } catch (error) {
                console.error(`Error updating printer ${printerId}:`, error);
                this.showError(`Error updating printer ${data.printer}`);
            }
        }
    
        updatePrinterStatus(card, data) {
            // Update status fields with validation
            const statusElements = {
                'printer-status': data.state || 'Unknown',
                'printer-progress': data.percent != null ? `${data.percent}%` : 'N/A',
                'printer-layer': data.lines != null ? `${data.lines}/${data.lines_total}` : 'N/A',
                'printer-time': data.remaining_time || 'N/A',
                'printer-end': data.approx_end || 'N/A'
            };
    
            for (const [id, value] of Object.entries(statusElements)) {
                const element = card.querySelector(`#${id}`);
                if (element) {
                    element.textContent = value;
                    element.classList.toggle('error-state', data.error);
                }
            }
        }
    
        showError(message) {
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.innerHTML = `
                <div class="toast-header">
                    <strong class="me-auto">Error</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">${message}</div>
            `;
            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(() => toast.remove(), 5000);
        }
    
        // Add form validation
        validatePrinterForm(formData) {
            const required = ['host', 'port', 'user', 'password', 'device_id', 'printer_title'];
            const errors = [];
    
            required.forEach(field => {
                if (!formData[field]) {
                    errors.push(`${field} is required`);
                }
            });
    
            if (formData.port) {
                const port = parseInt(formData.port);
                if (isNaN(port) || port < 1 || port > 65535) {
                    errors.push('Invalid port number');
                }
            }
    
            return errors;
        }
    }   
</script>
</body>
</html>